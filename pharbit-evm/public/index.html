<!DOCTYPE html>
<html>
<head>
    <title>Pharbit EVM Deployment</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" type="application/javascript"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px; margin: 5px; }
        .address { font-family: monospace; }
    </style>
</head>
<body>
    <h1>Pharbit EVM Deployment Interface</h1>
    
    <div id="metamask-status">
        <h3>MetaMask Status</h3>
        <p id="connection-status">Not connected</p>
        <button onclick="connectWallet()">Connect Wallet</button>
    </div>

    <div id="deployment" style="margin-top: 20px;">
        <h3>Contract Deployment</h3>
        <button onclick="deployContracts()">Deploy Contracts</button>
        <div id="deployment-status"></div>
    </div>

    <div id="contract-addresses" style="margin-top: 20px;">
        <h3>Contract Addresses</h3>
        <p>PharbitCore: <span id="core-address" class="address">-</span></p>
        <p>ComplianceManager: <span id="compliance-address" class="address">-</span></p>
        <p>BatchNFT: <span id="nft-address" class="address">-</span></p>
    </div>

    <script>
        let provider;
        let signer;
        const deployerABI = [/* We'll add this later */];
        
        async function connectWallet() {
            try {
                if (typeof window.ethereum !== 'undefined') {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    await provider.send("eth_requestAccounts", []);
                    signer = provider.getSigner();
                    const address = await signer.getAddress();
                    document.getElementById('connection-status').innerHTML = 
                        `Connected: ${address}`;
                }
            } catch (err) {
                console.error(err);
                document.getElementById('connection-status').innerHTML = 
                    `Error: ${err.message}`;
            }
        }

        async function deployContracts() {
            if (!signer) {
                alert('Please connect your wallet first');
                return;
            }
            
            const deploymentStatus = document.getElementById('deployment-status');
            try {
                deploymentStatus.innerHTML = 'Deploying contracts...';
                
                // Deploy PharbitDeployer
                const PharbitDeployer = new ethers.ContractFactory(
                    deployerABI,
                    deployerBytecode,
                    signer
                );
                
                const deployer = await PharbitDeployer.deploy();
                await deployer.deployed();
                
                deploymentStatus.innerHTML = 'Contracts deployed successfully!';
                
                // Get addresses
                const [core, compliance, nft] = await deployer.getAddresses();
                
                document.getElementById('core-address').innerHTML = core;
                document.getElementById('compliance-address').innerHTML = compliance;
                document.getElementById('nft-address').innerHTML = nft;
            } catch (err) {
                console.error(err);
                deploymentStatus.innerHTML = `Error: ${err.message}`;
            }
        }
    </script>
</body>
</html>